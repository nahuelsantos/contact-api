#!/bin/bash

# Git pre-push hook for Contact API
# This hook runs linting and tests before allowing a push

set -e

echo "ğŸ” Running pre-push checks..."

# Check if golangci-lint is installed
if ! command -v golangci-lint &> /dev/null; then
    echo "âŒ golangci-lint is not installed. Please install it first:"
    echo "   go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest"
    exit 1
fi

# Run linting
echo "ğŸ§¹ Running linter..."
if ! golangci-lint run ./...; then
    echo "âŒ Linting failed. Please fix the issues before pushing."
    exit 1
fi

# Run tests
echo "ğŸ§ª Running tests..."
if ! go test -v -race ./...; then
    echo "âŒ Tests failed. Please fix the failing tests before pushing."
    exit 1
fi

echo "âœ… All checks passed! Proceeding with push..." 